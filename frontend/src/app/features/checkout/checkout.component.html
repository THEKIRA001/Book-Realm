<div class="checkout-page">
    <h2>Checkout</h2>

    <div *ngIf="purchaseSuccess()" class="purchase-card">
      <h3>Purchase successful üéâ</h3>
      <p>Thank you for your purchase. Your order has been placed successfully.</p>
      <div class="purchase-card-btn">
        <a routerLink="/orders" class="btn btn-primary">View Orders</a>
        <a routerLink="/books" class="btn btn-outline">Continue shopping</a>
      </div>
    </div>

    <div class="checkout-grid" *ngIf="cartItemDetailed().length; else emptyCart">
        <div class="left-column">
            <section class="card profile-card" *ngIf="user() as u">
                <h3>Your Details</h3>
                <div class="profile-card-details">
                    <img [src]="u.avatar || 'https://ui-avatars.com/api/?name=' + u.username" alt="Avatar"
                        class="avatar" />
                    <span>
                        <p class="name">{{ u.username || 'Guest User' }}</p>
                        <p class="email">{{ u.email }}</p>
                    </span>
                </div>
            </section>

            <section class="card items-card">
                <h3>Items in your order</h3>

                <div class="order-item" *ngFor="let item of cartItemDetailed()">

                    <div class="info">
                        <div class="image-column">
                            <img [src]="item.book!.image" [alt]="item.book!.title " class="book-cover" />
                        </div>
                        <span class="info-details">
                            <h4>{{ item.book.title }}</h4>
                            <p class="author">by {{ item.book.author }}</p>
                            <p class="price">Price {{ item.book.price | currency: 'INR' : 'symbol' : '1.2-2'}}</p>
                        </span>
                    </div>

                    <div class="qty-total">
                        <p>Qty: <span>{{ item.quantity }}</span></p>
                        <p>Total: <span>{{ (item.book.price * item.quantity) | currency: 'INR' : 'symbol' : '1.2-2'
                                }}</span></p>
                    </div>
                </div>
            </section>
        </div>
        <div class="right-column">
            <section class="card summary-card">
                <h3>Order Summary</h3>

                <div class="summary-row">
                    <span class="label">Items</span>
                    <span class="value">{{ cartItemDetailed().length }}</span>
                </div>

                <div class="summary-row">
                    <span class="label">Total amount</span>
                    <span class="value">{{ totalPrice() | currency : 'INR' : 'symbol' : '1.2-2' }}</span>
                </div>

                <div class="summary-buttons">
                    <button class="btn btn-primary btn-buy" (click)="onBuyNow()"
                        [disabled]="loading() || !cartItemDetailed().length">
                        {{ loading() ? 'Placing Order...' : 'Buy Now'}}
                    </button>

                    

                    <a routerLink="/cart" class="back-to-cart">‚Üê Back to Cart</a>
                </div>
                <p class="error" *ngIf="error()">{{ error() }}</p>
            </section>
        </div>
    </div>

    <ng-template #emptyCart>
        <div class="empty-checkout">
            <p>Your cart is empty. Add some books to continue.</p>
            <a routerLink="/books" class="btn btn-outline">
                Browse books
            </a>
        </div>
    </ng-template>
</div>